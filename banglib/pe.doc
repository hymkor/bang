｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢
｢｢｢｢   IBM-PC/AT 画面モード 13h 専用 パターンエディタ 「ばんぐぺんき」   ｢｢｢｢
｢｢｢｢                                                                     ｢｢｢｢
｢｢｢｢      1994 (C) K.Hayama(葉山 薫), Copyleft for private uses !        ｢｢｢｢
｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢｢

■ そっ、それは ■

　画面モード 13h(320x200x256 色) でのゲーム用のパターンの製作に主眼をおいたパ
ターンエディタです。特徴としては、

・背景との重ね合せを考慮して透明色を用意。 またプログラム中での重ね合わせが実
  現しやすいデータ形式を用意している。(サンプル表示ルーチン付き)

・８×８から 64×64 までの大きさのパターンをエディット可能。合計サイズとして、
  128×128 まで一度にエディット可能。

・ファイル名の入力以外の操作は、全てマウスだけで可能。

があげられます。一方、弱点も公開すると、

・パレット機能がない!
・漢字ファイル名が使えない!
・せまっくるしい!

などがあげられてしまいます (Π_Π)。パレット機能がないのは、 えらい失点ではあ
りますが、 それを除けばゲーム作りには問題はほとんどないと思われますので、皆様
方にも使っていただけたらと思います。


■ 立ち上げ方 ■

  mouse.com(あるいは互換ドライバ) を常駐させ、

        C:\>pe[Enter]
           ~~~~~~~~~~
と入力すると、モニターが「ぷちっ」と鳴って、以下のような画面が現れます。また、
        C:\>pe ?[Enter]
            ~~~~~~~~~~~
と入力すると、現在のバージョンを表示します。


■ 画面の説明 ■

         ┌ｴﾃﾞｨｯﾄ 画面─┐ ┌ｱｲｺﾝ┐┌リアル画面─┐
        +------------------------------------------+
        | ................ _______┌─┐           |
        | ................ _______│  │           |
        | ................ _______│  │           |
        | ................ _______└─┘           |
        | ................ _______                 |
        | ................ _______                 |
        | ................ _______                 |
        | ................ _______                 |
        |  15 R ]]]]]]]]]]]]        POS =[  0,  0] | ┐
        | ┌┐G ]]]]]]]]]]]]]]]]]]  SIZE=[ 32, 32] | │ 状態表示
        | └┘B ]]]]]]]                            | ┘
        | 田田田田田田田田田田田田田田田田田田田田 | ┐ パレット
        | 田田田田田田田田田田田田田田田田田田田田 | ┘    テーブル
        | ばんぐぺんき ver.0.2?  1994 (C) K.HAYAMA | ] コピーライト表示
        |                                          | ] メッセージライン
        | [LEFT]..PSET/SELECT  [RIGHT]..SPOIT      | ] ガイドライン
        +------------------------------------------+

　「リアル画面」とは、エディットするパターンが原寸大で表示される領域です。 こ
の内の白い四角形で囲まれた範囲を拡大した領域が 「エディット画面」です。パター
ンは、このエディット画面を通じて修正します。

　エディット画面では、マウスの左ボタンで色を描くことが、 右ボタンで色を拾うこ
と  (以後、スポイトと呼ぶ) ができます。現在のペンカラーは、エディット画面の下
の状態表示エリア左に表示されます。また「パレットテーブル」を左 / 右クリックす
ることでも色を拾えます。

　リアル画面の任意の場所をクリックすることで、 エディット画面の位置を８ドット
単位で移動させることができます。 その位置と範囲は、状態表示エリア右に表示され
ます。

  そして、エディット画面とリアル画面に挟まれた文字列がアイコンです。


■ アイコンの説明 ■

 * < UP > と < DOWN >
        アイコンテーブルに収まらない部分のアイコンを画面に表示します。< UP  >
        でロールダウン、< DOWN > でロールアップします。

 * QUIT ( ショートカットキー:'q' )
        パターンエディタを終了します。全画面のセーブの有無と、 終了の確認をし
        てきます。 マウスの左ボタン、キーボードの 'ｙ' で <Yes>、同様に右ボタ
        ン、'ｎ' で <No> と入力できます。ファイル名の入力については、ファイル
        セレクタの項で説明します。 このアイコンは最初に表示されていないので、
        <DOWN> アイコンで出現させなければ、いけません。

 * BG-COLOR ( 'b' )
        ペンカラーを透明色にします。透明色は、 このアイコンかスポイトでしか拾
        うことができません。(パレットテーブルにはありません)

 * 8x8('1') , 16x16('2') , 32x32('3') , 64x64('4')
        エディット画面の大きさを変えます。

 * WIN-COPY ('c')
        エディット画面のサイズ単位で、複写を行います。 現在のエディット範囲が
        転送元になり、転送先はマウスで新たにリアル画面上をクリックします。
        　なお、転送元の透明色のドットは転送されず、 転送先のドットが保存され
        ます。リアル画面以外をクリックするとキャンセルされます。

 * BOX-COPY (Ctrl-C)
        エディット画面中での複写を行います。 対角の頂点となる点をクリックし、
        次に転送先の領域の左上の点をクリックしてください。

 * CLS ('C' )
        現在のエディット画面の領域を透明色で塗りつぶします。

 * LINE ('l')
        n 個 (n≧2) の点を次々に結びます。 エディット画面外をクリックすること
        で終了します。

 * BOX ( 'x' )
        二点を対角上の点とする長方形を塗りつぶします。 エディット画面外をクリ
        ックすることでキャンセルできます。

 * CIRCLE ( 'r' )
        塗りつぶした円を描きます。まず、中心の点をクリックし、 次に円周上の一
        点をクリックして下さい。 円は、画面の縦横のドットの寸法比が 9:10 だと
        仮定して描かれます。(320x200 モードではドットが正方形ぢゃないんですよ)

 * SAVE('s')/LOAD('l')
        現在のエディット画面の範囲をセーブ / ロードします。

        ファイル形式:
                最初の (w*h) bytes :
                        カラーコード ( 1 byte : 1 dot )
                次の (w*h/8) bytes :
                         透明フラグ ==1: 透明 ==0: 非透明 ( 1 bit  : 1 dot )
                 [EOF]

        サイズ情報はセーブされない。

 * SAVE-ALL('S')/ LOAD-ALL('L')
          リアル画面全体をセーブ / ロードします。ファイル形式は、SAVE/LOAD と
          同じです。拡張子は特に付加されませんが、できれば「.PE 」 に統一して
          いただくことを希望します。

 * WRITE('W')
          SAVE/LOAD コマンドとは違う形式でファイルに出力します。 このファイル
          をこのパターンエディタでロードすることはできませんが、 ゲーム等のア
          プリケーションで画面に出力するのに適した形式になっています。 拡張子
          は同様に「.SPR」にしていただけたらと思います。

        ファイル形式:
                2 bytes : 次の非透明ドットまでの、(y 座標の距離)*(1  行あたり
                の dot 数) + (x 座標の距離)
                2 bytes : そのドットから連続する非透明ドットのドット数
                          ==0 の時 パターンは終わり、続いて [EOF] が現れる。
                n bytes : 連続する非透明ドットのカラーコードの並び
                < 最初に戻る >

        1 行あたりの dot 数はセーブされません。

        例)
                /* djgpp ならば、far を消し、0xA0000000 を 0xD0000000 にする
                 * 画面モード 13h を想定
                 */
                void draw(int x,int y,char *pattern)
                {
                    char far *vramptr; = (char far *)0xA0000000 + x + y*320;
                    union{
                        unsigned short far *word;
                        unsigned char  far *byte;
                    } srcptr;

                    srcptr.byte = pattern;
                    vramptr     = (char far *)0xA0000000 + x + y*320;

                    for(;;){
                        int i;

                        /* 最初のワードはスキップ量 */
                        vramptr += *srcptr.word++;

                        /* 次のワードはコピーのバイト数
                           ==0 なら、終了する       */
                        if( (i=*srcptr.word++) == 0 )
                            break;

                        while(i--)
                            *vramptr++ = *srcptr.byte++;
                    }
                }

■ ファイルセレクタ ■

  ファイルを扱うコマンドを選択すると、 まずキーボードからの入力モードとなりま
  す。この時、以下のようなキーが使えます。Emacs 準拠。

        Enter           ^M      入力終結
        Esc             ^G      キャンセル
                        ^F      カーソルを次の文字へ移動
                        ^B      カーソルを前の文字へ移動
                        ^A      カーソルを先頭へ移動
                        ^E      カーソルを末尾へ移動
                        ^D      カーソル位置の文字を削除
        BackSpace       ^H      カーソルの前の文字を削除

  キーボード入力の際に、何も入力しないで Enter/^M を入力すると、 マウスによる
  ファイルセレクタが立ち上がります。

        白い文字     ... そのファイルを選択
        黄色い文字   ... そのディレクトリに移動
        << MORE >>   ... 画面に表示しきれないファイルを表示
        << LESS >>   ... [MORE] を選択する前に表示していたファイルを表示
        [C] [D] など ... 交換不可能なディスクドライブに移動
        <A> <B> など ... 交換可能なディスクドライブに移動
        その他の領域 ... キャンセル

■ 配布条件など ■

PE.EXE はフリーソフトウェアです。転載・配布は自由ですが、 著作権は作者:  葉山
薫にあります。著作権を放棄した PDS ではありません。なお、本プログラムで万が一、
何らかの損失が生じても作者は一切責任を負いません。


■ 履歴 ■

0.0x (Borland C++ Version)      '93 夏ごろ
        　京都大学 11 月祭展示用ゲーム「ばん！ばすたぁ」 製作用に京大マイコン
        クラブ第二部室にて開発。

0.1x (djgpp Version)            '93 冬から'94春ごろかな?
        　互換機を買ったのはいいが、Borland C++  まで買えなかったので、 djgpp
        にコンパイラを変更。386 以上の CPU でしか動かなくしてしまった。ファイ
        ルセレクタ他、余計な機能をどんどん付けていった。

0.2x (LSI C-86 Version)
        　go32.exe がいつもついてまわるのが嫌だったので、C++ で組んでいたもの
        を C に書替えて、コンパイラを今度は LSI C-86 試食版に変更した。元々、
        クラスなどの機能はあまり使っていなかったので、 一日で出来てしまった。
        再び、286 以下の CPU でも動くようになってしまった。(^_^;)

        0.20 (94/7/18)  ☆「Circle」を追加。
        0.21 (94/7/21)  ☆「ばんぐぺんき」と名付け、ロゴを作る。
